<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Корзина — PADOBI PC</title>
  <meta name="description" content="Корзина — PADOBI PC. Чёткий и понятный интерфейс для оформления заказа.">
  <link rel="icon" href="photo_2025-09-02_11-12-54.jpg">

  <style>
    /* Align visual tokens (colors / spacing / typography) with profile.html */
    :root{
      --bg:#000;
      --panel:#0b0b0b;
      --card:#0f0f0f;
      --muted:#a9a9a9; /* from profile.html */
      --text:#fff;
      --brand:#0ff;    /* cyan reserved (we'll use primarily for buttons) */
      --accent:#a855f7;
      --radius:16px;
      --shadow:0 16px 48px rgba(0,0,0,.75);
      --container:1100px;
      --mono-border: rgba(255,255,255,0.03);
      --glass: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
      line-height:1.5;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    a{color:inherit;text-decoration:none}
    img{display:block;max-width:100%}
    .container{max-width:var(--container);margin:0 auto;padding:0 20px}

    /* Header same as profile.html */
    header{
      position:sticky;top:0;z-index:120;background:var(--bg);
      border-bottom:1px solid var(--mono-border);
      box-shadow:0 0 20px rgba(0,255,255,.03);
      backdrop-filter: blur(4px);
    }
    .nav{height:72px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:900;letter-spacing:.6px;cursor:pointer}
    .brand__logo{width:42px;height:42px;border-radius:10px;overflow:hidden;flex-shrink:0;box-shadow:0 0 10px rgba(0,255,255,.12)}
    .brand__text{font-size:18px;text-transform:uppercase}
    .actions{display:flex;align-items:center;gap:10px}
    .icon-btn{position:relative;display:grid;place-items:center;width:42px;height:42px;border-radius:10px;background:var(--panel);border:1px solid #232323;cursor:pointer;transition:.18s;overflow:visible}
    .badge{position:absolute;top:-6px;right:-6px;background:var(--brand);color:#000;font-size:11px;font-weight:800;padding:2px 6px;border-radius:999px;border:2px solid var(--panel);box-shadow:0 0 10px var(--brand)}

    /* Layout */
    main{padding:36px 0}
    .stepper{display:flex;justify-content:center;margin:18px 0 22px 0;gap:10px}
    .step-btn{flex:1 1 0px;min-width:110px;max-width:220px;padding:12px 8px;text-align:center;border-radius:12px;background:var(--panel);color:var(--muted);font-size:13px;font-weight:800;border:1px solid #212121;cursor:pointer;letter-spacing:.06em;text-transform:uppercase}
    .step-btn.active{color:var(--text);background:var(--card);border-color:rgba(255,255,255,0.04);cursor:default}
    .step-btn.done{background:var(--card);color:#fff;border-color:#2a2a2a}

    .cart-wrap{max-width:var(--container);margin:0 auto;padding:18px;border-radius:14px;background:var(--glass);border:1px solid var(--mono-border);box-shadow:var(--shadow)}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }

    /* Left column */
    .cart-left{display:flex;flex-direction:column;gap:18px}
    .section-title{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .section-left{display:flex;align-items:center;gap:12px}
    .section-left h2{margin:0;font-size:18px;letter-spacing:.6px;text-transform:uppercase}
    .itemsSummary{color:var(--muted);font-size:13px;font-weight:700;display:flex;gap:8px;align-items:center}
    .itemsSummary strong{color:var(--text);font-weight:900}

    .muted{color:var(--muted);font-size:13px}

    .cart-list{display:flex;flex-direction:column;gap:12px}
    .cart-item{
      display:flex;gap:12px;align-items:flex-start;background:var(--panel);padding:12px;border-radius:10px;border:1px solid #161616;
    }
    .cart-item-thumb{width:92px;height:76px;border-radius:8px;overflow:hidden;flex-shrink:0;background:#0b0b0b;display:flex;align-items:center;justify-content:center;border:1px solid #1a1a1a}
    .cart-item-thumb img{width:100%;height:100%;object-fit:cover}
    .cart-item-info{flex:1;min-width:0;display:flex;flex-direction:column;gap:6px}
    .cart-item-top{display:flex;align-items:flex-start;justify-content:space-between;gap:8px}
    .cart-item-title{font-weight:900;font-size:15px;margin:0 0 2px 0}
    .cart-item-desc{color:var(--muted);font-size:13px;margin:0}
    .cart-controls{display:flex;align-items:center;gap:10px;flex-wrap:nowrap;margin-top:8px;justify-content:space-between}
    .controls-left{display:flex;align-items:center;gap:10px}
    .qty-control{display:flex;align-items:center;gap:6px;background:#0c0c0c;padding:6px;border-radius:8px;border:1px solid #191919}
    .qty-btn{width:34px;height:34px;border-radius:8px;border:none;background:var(--brand);color:#000;font-weight:900;cursor:pointer;display:grid;place-items:center}
    .qty-value{min-width:34px;text-align:center;font-weight:900;color:var(--text);background:transparent;border-radius:6px}
    .line-price{font-weight:900;color:var(--accent);font-size:15px;white-space:nowrap}
    .remove-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:13px;padding:6px;border-radius:8px}
    .remove-btn:hover{color:#fff;background:rgba(255,255,255,0.02)}

    /* Right column / summary */
    .cart-right{display:flex;flex-direction:column;gap:12px}
    .summary{background:var(--panel);padding:16px;border-radius:12px;border:1px solid #171717}
    .summary h3{margin:0 0 8px 0;font-size:15px}

    /* User requested alignment: label above, value below — compact and readable like profile */
    .summary .row{display:flex;flex-direction:column;align-items:flex-start;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02);gap:6px}
    .summary .row:last-child{border-bottom:none}
    .summary .row .label{color:var(--muted);font-size:13px}
    .summary .row .value{font-weight:900;color:var(--text);font-size:16px}

    .total{font-size:18px;font-weight:900;color:var(--text);margin-top:10px}

    .checkout-actions{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .checkout-btn{display:block;padding:12px;border-radius:10px;border:none;background:var(--brand);color:#000;font-weight:900;cursor:pointer}
    .checkout-btn.secondary{background:transparent;border:1px solid var(--mono-border);color:var(--muted);font-weight:700}

    .hidden{display:none!important}

    /* Checkout form */
    .order-form{display:flex;flex-direction:column;gap:12px}
    .order-row{display:flex;gap:10px}
    .order-row .order-group{flex:1;display:flex;flex-direction:column}
    .order-group label{font-size:13px;color:var(--muted);margin-bottom:6px;font-weight:700}
    .order-group input,.order-group select{padding:10px;border-radius:8px;background:#0b0b0b;border:1px solid #1b1b1b;color:var(--text);outline:none}
    .delivery-options{display:flex;gap:8px;flex-wrap:wrap}
    .delivery-option{padding:8px 10px;border-radius:8px;border:1px solid #1a1a1a;background:#0b0b0b;color:var(--muted);cursor:pointer;font-weight:700}
    .delivery-option.selected{border-color:rgba(255,255,255,0.06);color:var(--text);background:rgba(255,255,255,0.01)}
    .delivery-details{background:var(--panel);border-radius:8px;padding:12px;border:1px solid #171717}

    /* secure badge like profile */
    .secure-badge{display:inline-flex;align-items:center;gap:8px;color:var(--muted);font-size:13px}
    .secure-badge .icon{width:18px;height:18px;background:rgba(0,0,0,0.25);border-radius:6px;display:grid;place-items:center;color:var(--brand);font-weight:900}

    .support-box{
      display:flex;gap:12px;align-items:flex-start;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
    }
    .support-icon{
      width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;flex-shrink:0;box-shadow:0 6px 18px rgba(0,240,239,0.06);
    }
    .support-icon svg{width:22px;height:22px;color:#000}
    .support-content{display:flex;flex-direction:column;gap:6px}
    .support-title{font-weight:900;color:#fff}
    .support-contact{font-weight:800;color:var(--brand)}
    .support-note{font-size:13px;color:var(--muted)}

    button:focus, input:focus { outline:2px solid rgba(0,255,255,0.06); outline-offset:2px; }

    @media (max-width:540px){
      .cart-item-thumb{width:72px;height:60px}
      .cart-wrap{padding:14px}
      .stepper{flex-direction:column;gap:8px}
      .order-row{flex-direction:column}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav" role="banner">
      <a class="brand" href="index.html" aria-label="PADOBI PC — Home">
        <span class="brand__logo"><img src="photo_2025-09-02_11-12-54.jpg" alt="Padobi logo" /></span>
        <span class="brand__text">PADOBI PC</span>
      </a>

      <div class="actions" role="navigation" aria-label="Header actions">
        <div class="lang" aria-label="Language switch">
          <button type="button" data-lang="ru" aria-pressed="true">RU</button>
          <button type="button" data-lang="ua" aria-pressed="false">UA</button>
          <button type="button" data-lang="en" aria-pressed="false">EN</button>
        </div>

        <button id="headerProfileBtn" class="profile-btn" title="Профиль" aria-label="Профиль">
          <img id="smallAvatar" src="" alt="profile" style="display:none" />
          <svg id="profileIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><circle cx="12" cy="7" r="4"/><path d="M6 21a6 6 0 0 1 12 0"/></svg>
        </button>

        <button class="icon-btn" title="Cart" aria-label="Cart" onclick="window.location.href='cart.html'">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M6 6h15l-1.5 9h-12z"/><path d="M6 6l-2-3"/><circle cx="9" cy="21" r="1.5"/><circle cx="18" cy="21" r="1.5"/></svg>
          <span class="badge" id="cartCount">2</span>
        </button>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="stepper" id="mainStepper" aria-hidden="false">
        <button class="step-btn active" id="stepBtn1" type="button">1. Корзина</button>
        <button class="step-btn" id="stepBtn2" type="button" disabled>2. Оформление</button>
        <button class="step-btn" id="stepBtn3" type="button" disabled>3. Подтверждение</button>
      </div>

      <div class="cart-wrap">
        <div class="grid">
          <!-- LEFT -->
          <div class="cart-left" aria-live="polite">
            <div class="section-title">
              <div class="section-left">
                <h2 id="cartTitle">Ваша корзина</h2>
                <!-- replaced header helper with requested compact summary -->
                <div class="itemsSummary" id="itemsSummary"><span id="itemsCountInline">2 услуг</span> • <strong id="subtotalText">20 100 ₴</strong></div>
              </div>
              <div class="muted" style="font-size:13px">Проверьте, пожалуйста, что всё верно</div>
            </div>

            <div class="cart-step" id="cartStep1">
              <div class="cart-list" id="cartList" aria-label="Список товаров">
                <div class="cart-item" data-id="item-1" data-price="18500" role="group" aria-label="Сборка ПК Старт">
                  <div class="cart-item-thumb" aria-hidden="true"><img src="pc1.png" alt=""></div>
                  <div class="cart-item-info">
                    <div class="cart-item-top">
                      <div>
                        <div class="cart-item-title">Сборка ПК “Старт”</div>
                        <div class="cart-item-desc">Процессор Intel, 16 ГБ, SSD, Windows</div>
                      </div>
                      <div class="line-price" aria-hidden="true" data-line-price>18 500 ₴</div>
                    </div>

                    <div class="cart-controls">
                      <div class="controls-left">
                        <div class="qty-control" aria-label="Количество единиц">
                          <button class="qty-btn dec" title="Уменьшить" aria-label="Уменьшить количество">−</button>
                          <div class="qty-value" data-qty aria-live="polite">1</div>
                          <button class="qty-btn inc" title="Увеличить" aria-label="Увеличить количество">+</button>
                        </div>
                        <div class="note-small">Артикул: PAD-START</div>
                      </div>

                      <div style="display:flex;align-items:center;gap:8px">
                        <button class="remove-btn" title="Удалить" aria-label="Удалить услугу">Удалить</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="cart-item" data-id="item-2" data-price="800" role="group" aria-label="Замена SSD">
                  <div class="cart-item-thumb" aria-hidden="true"><img src="pc2.png" alt=""></div>
                  <div class="cart-item-info">
                    <div class="cart-item-top">
                      <div>
                        <div class="cart-item-title">Замена SSD</div>
                        <div class="cart-item-desc">Установка нового накопителя, перенос данных</div>
                      </div>
                      <div class="line-price" aria-hidden="true" data-line-price>1 600 ₴</div>
                    </div>

                    <div class="cart-controls">
                      <div class="controls-left">
                        <div class="qty-control" aria-label="Количество единиц">
                          <button class="qty-btn dec" title="Уменьшить" aria-label="Уменьшить количество">−</button>
                          <div class="qty-value" data-qty aria-live="polite">2</div>
                          <button class="qty-btn inc" title="Увеличить" aria-label="Увеличить количество">+</button>
                        </div>
                        <div class="note-small">Гарантия 30 дней</div>
                      </div>

                      <div style="display:flex;align-items:center;gap:8px">
                        <button class="remove-btn" title="Удалить" aria-label="Удалить услугу">Удалить</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div id="emptyState" class="hidden empty-state" role="status">
                <div style="font-weight:800;margin-bottom:8px">В корзине пока ничего нет.</div>
                <div><a class="checkout-btn secondary" href="index.html">Перейти в каталог</a></div>
              </div>

              <!-- the inline "Оформить заказ / note" block removed per your request -->
            </div>

            <!-- STEP 2: Оформление -->
            <div class="cart-step hidden" id="cartStep2" aria-hidden="true">
              <form id="checkoutForm" class="order-form" autocomplete="off" novalidate>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <div style="font-weight:900;color:var(--text);text-transform:uppercase">Контактные данные</div>
                  <div class="secure-badge" title="Данные передаются безопасно">
                    <div class="icon">✔</div>
                    <div style="color:var(--muted)">Данные защищены и шифруются</div>
                  </div>
                </div>

                <div class="order-row">
                  <div class="order-group">
                    <label for="fullName">ФИО*</label>
                    <input id="fullName" name="fullName" type="text" placeholder="Ваше имя полностью" required aria-required="true" />
                  </div>
                  <div class="order-group">
                    <label for="phone">Телефон*</label>
                    <input id="phone" name="phone" type="tel" placeholder="+38 (0__) ___-__-__" required aria-required="true" />
                  </div>
                </div>

                <div class="order-row">
                  <div class="order-group">
                    <label for="email">E-mail*</label>
                    <input id="email" name="email" type="email" placeholder="example@gmail.com" required aria-required="true" />
                  </div>
                  <div class="order-group">
                    <label for="note">Комментарий</label>
                    <input id="note" name="note" type="text" placeholder="Доп. пожелания, пометки" />
                  </div>
                </div>

                <div style="font-weight:900;color:var(--text);text-transform:uppercase">Доставка</div>
                <div style="color:var(--muted);font-size:13px">Выберите способ доставки — точные параметры указываются ниже</div>
                <div class="delivery-options" id="deliveryGroup" role="group" aria-label="Выбор доставки" style="margin-top:8px;">
                  <button type="button" class="delivery-option selected" data-value="courier" aria-pressed="true">Курьер</button>
                  <button type="button" class="delivery-option" data-value="nova" aria-pressed="false">Новая Почта</button>
                  <button type="button" class="delivery-option" data-value="pickup" aria-pressed="false">Самовывоз</button>
                </div>

                <div id="courierFields" class="delivery-details" style="display:block;margin-top:10px;">
                  <div class="order-row" style="gap:12px;">
                    <div class="order-group" style="flex:0.6">
                      <label for="cityCourier">Город*</label>
                      <input type="text" id="cityCourier" name="cityCourier" placeholder="Киев" required />
                    </div>
                    <div class="order-group" style="flex:1">
                      <label for="addressCourier">Улица, дом, квартира*</label>
                      <input type="text" id="addressCourier" name="addressCourier" placeholder="ул. Примерная, 1, кв.10" required />
                    </div>
                  </div>
                </div>

                <div id="novaFields" class="delivery-details hidden" aria-hidden="true" style="margin-top:10px;">
                  <div class="order-row" style="gap:12px;">
                    <div class="order-group">
                      <label for="cityNova">Город*</label>
                      <input type="text" id="cityNova" name="cityNova" placeholder="Киев" />
                    </div>
                    <div class="order-group" style="max-width:160px">
                      <label for="officeNova">№ отделения*</label>
                      <input type="text" id="officeNova" name="officeNova" placeholder="напр. 10" />
                    </div>
                  </div>
                </div>

                <div id="pickupFields" class="delivery-details hidden" aria-hidden="true" style="margin-top:10px;">
                  <div style="color:var(--muted);font-size:13px">Самовывоз — г. Киев, ул. Будущего, 42. Режим: Пн‑Сб 10:00‑19:00</div>
                </div>

                <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
                  <label class="dont-call" id="dontCallLabel">
                    <input type="checkbox" id="dontCallCheck" /> <span style="font-size:13px;color:var(--muted)">Не перезванивать (только SMS)</span>
                  </label>
                  <div class="policy">
                    <input type="checkbox" id="userPolicy" required />
                    <label for="userPolicy" style="font-size:13px;color:var(--muted)">Я принимаю политику конфиденциальности и правила пользования*</label>
                  </div>
                </div>

                <div style="display:flex;gap:10px;justify-content:flex-end;">
                  <button type="button" class="checkout-btn secondary" id="backToCartBtn">Назад</button>
                  <button type="submit" class="checkout-btn" id="finalOrderBtn">Подтвердить заказ</button>
                </div>
              </form>
            </div>

            <!-- STEP 3: Confirmation -->
            <div class="cart-step hidden" id="cartStep3" aria-hidden="true">
              <div class="confirmation" id="confirmationBlock">
                <div style="font-weight:900;font-size:16px">Спасибо! Заказ получен</div>
                <div class="muted" style="margin-top:8px">Номер вашего заказа:</div>
                <div class="order-id" id="orderId">—</div>
                <div style="margin-top:12px;color:var(--muted);" id="orderSummaryText"></div>
                <div style="margin-top:14px"><button class="checkout-btn" id="toHomeBtn">Вернуться на главную</button></div>
              </div>
            </div>
          </div>

          <!-- RIGHT -->
          <aside class="cart-right" aria-label="Сводка заказа">
            <div class="summary" aria-labelledby="summaryTitle">
              <h3 id="summaryTitle">Итого</h3>

              <!-- Stacked label + value as requested; values are tight and use same typography as profile -->
              <div class="row"><div class="label">Услуг</div><div class="value" id="summaryItemsCount">2</div></div>
              <div class="row"><div class="label">Стоимость услуг</div><div class="value" id="subtotal" data-value="20100">20 100</div></div>
              <div class="row"><div class="label">Доставка</div><div class="value" id="deliveryPrice" data-value="0">0 ₴</div></div>

              <div class="total" aria-live="polite">К оплате: <span id="totalAmount">20 100 ₴</span></div>

              <div class="checkout-actions">
                <button id="checkoutBtn" class="checkout-btn" aria-label="Оформить заказ">Оформить заказ</button>
              </div>
            </div>

            <div class="summary" aria-label="Поддержка">
              <h3>Поддержка</h3>
              <div class="support-box" role="group" aria-label="Контакты поддержки">
                <div class="support-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2z" stroke="rgba(0,0,0,0.08)"/>
                    <path d="M8 14s1.5-2 4-2 4 2 4 2" stroke="#000"/>
                    <circle cx="9" cy="10" r="1" fill="#000"/>
                    <circle cx="15" cy="10" r="1" fill="#000"/>
                  </svg>
                </div>
                <div class="support-content">
                  <div class="support-title">Нужна помощь?</div>
                  <div class="support-contact">+38 (068) 000‑00‑00</div>
                  <a class="support-contact" href="mailto:info@padobipc.com">info@padobipc.com</a>
                  <div class="support-note">Адрес: Киев, ул. Будущего, 42 • Пн‑Сб 10:00‑19:00</div>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container" style="padding:18px 0;text-align:center;color:var(--muted);font-size:13px;">
      © <span id="year"></span> PADOBI PC
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // Helpers
    function parseIntSafe(v){ return Number(String(v).replace(/\s+/g,'').replace(/[^0-9\-\.]/g,'')) || 0; }
    function formatMoney(n){ return n.toLocaleString('ru-RU') + ' ₴'; }

    // Elements
    const cartListEl = document.getElementById('cartList');
    const subtotalEl = document.getElementById('subtotal');
    const subtotalText = document.getElementById('subtotalText');
    const summaryItemsCount = document.getElementById('summaryItemsCount');
    const totalAmountEl = document.getElementById('totalAmount');
    const deliveryPriceEl = document.getElementById('deliveryPrice');
    const cartCountBadge = document.getElementById('cartCount');
    const itemsSummary = document.getElementById('itemsSummary');
    const emptyState = document.getElementById('emptyState');

    // Stepper
    const steps = [
      {btn: document.getElementById('stepBtn1'), block: document.getElementById('cartStep1')},
      {btn: document.getElementById('stepBtn2'), block: document.getElementById('cartStep2')},
      {btn: document.getElementById('stepBtn3'), block: document.getElementById('cartStep3')}
    ];
    let currentStep = 1;
    function goToStep(step){
      steps.forEach((s,i)=>{
        s.block.classList.toggle('hidden', i !== step-1);
        s.block.setAttribute('aria-hidden', String(i !== step-1));
        s.btn.classList.toggle('active', i === step-1);
        s.btn.classList.toggle('done', i < step-1);
        s.btn.disabled = !(i < step || i === step-1);
      });
      currentStep = step;
      window.scrollTo({top:0,behavior:'smooth'});
    }

    // wire buttons
    document.getElementById('checkoutBtn').addEventListener('click', ()=> goToStep(2));
    document.getElementById('backToCartBtn').addEventListener('click', ()=> goToStep(1));
    document.getElementById('toHomeBtn').addEventListener('click', ()=> window.location.href = 'index.html');
    steps.forEach((s,i)=> s.btn.addEventListener('click', ()=> { if(i < currentStep) goToStep(i+1); }));

    // Recalculate totals (keeps logic, but summary layout now shows stacked label+value)
    function recalc(){
      const items = Array.from(cartListEl.querySelectorAll('.cart-item'));
      let subtotal = 0;
      items.forEach(it=>{
        const price = parseIntSafe(it.getAttribute('data-price'));
        const qty = parseIntSafe(it.querySelector('[data-qty]').textContent);
        subtotal += price * qty;
        const line = it.querySelector('[data-line-price]');
        if(line) line.textContent = formatMoney(price * qty);
      });
      const delivery = parseIntSafe(deliveryPriceEl.getAttribute('data-value') || deliveryPriceEl.textContent);
      subtotalEl.textContent = subtotal; // plain number (for internal / simple display)
      subtotalEl.setAttribute('data-value', subtotal);
      subtotalText.textContent = formatMoney(subtotal); // header formatted
      summaryItemsCount.textContent = items.length;
      document.getElementById('itemsCountInline').textContent = items.length + ' услуг';
      itemsSummary.innerHTML = items.length + ' услуг • <strong>' + formatMoney(subtotal) + '</strong>';
      cartCountBadge.textContent = items.length;
      totalAmountEl.textContent = formatMoney(subtotal + delivery);
      if(items.length === 0) {
        emptyState.classList.remove('hidden');
      } else {
        emptyState.classList.add('hidden');
      }
    }

    // Quantity & remove handlers
    cartListEl.addEventListener('click', (e)=>{
      const target = e.target;
      const item = target.closest('.cart-item');
      if(!item) return;
      if(target.classList.contains('inc') || target.classList.contains('dec') || target.classList.contains('qty-btn')){
        const qtyEl = item.querySelector('[data-qty]');
        let qty = parseIntSafe(qtyEl.textContent);
        qty = target.classList.contains('inc') ? qty + 1 : Math.max(0, qty - 1);
        qtyEl.textContent = qty;
        if(qty === 0) item.remove();
        recalc();
      } else if(target.classList.contains('remove-btn')){
        item.remove();
        recalc();
      }
    });

    // Delivery selection (form delivery buttons)
    const deliveryGroupBtns = Array.from(document.querySelectorAll('#deliveryGroup .delivery-option'));
    function setDelivery(value){
      let price = 0;
      deliveryGroupBtns.forEach(btn => btn.classList.toggle('selected', btn.getAttribute('data-value') === value));
      if(value === 'courier'){ price = 0; document.getElementById('courierFields').style.display = 'block'; document.getElementById('novaFields').classList.add('hidden'); document.getElementById('pickupFields').classList.add('hidden'); }
      if(value === 'nova'){ price = 120; document.getElementById('courierFields').style.display = 'none'; document.getElementById('novaFields').classList.remove('hidden'); document.getElementById('pickupFields').classList.add('hidden'); }
      if(value === 'pickup'){ price = 0; document.getElementById('courierFields').style.display = 'none'; document.getElementById('novaFields').classList.add('hidden'); document.getElementById('pickupFields').classList.remove('hidden'); }
      deliveryPriceEl.textContent = price + ' ₴';
      deliveryPriceEl.setAttribute('data-value', price);
      recalc();
    }
    deliveryGroupBtns.forEach(btn => btn.addEventListener('click', ()=> setDelivery(btn.getAttribute('data-value'))));

    // Checkout submit (same behavior: localStorage)
    document.getElementById('checkoutForm').addEventListener('submit', function(e){
      e.preventDefault();
      const policy = document.getElementById('userPolicy');
      if(!policy.checked){ alert('Пожалуйста, примите политику конфиденциальности и правила пользования.'); return; }

      const order = {
        id: 'ORD-' + Date.now(),
        created_at: new Date().toISOString(),
        customer: {
          name: document.getElementById('fullName').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          email: document.getElementById('email').value.trim(),
          note: document.getElementById('note').value.trim(),
        },
        delivery: (function(){
          const sel = deliveryGroupBtns.find(b => b.classList.contains('selected'));
          const type = sel ? sel.getAttribute('data-value') : 'courier';
          const details = {};
          if(type === 'courier'){
            details.city = document.getElementById('cityCourier').value.trim();
            details.address = document.getElementById('addressCourier').value.trim();
          } else if(type === 'nova'){
            details.city = document.getElementById('cityNova').value.trim();
            details.nova_office = document.getElementById('officeNova').value.trim();
          }
          return { type, details };
        })(),
        items: [],
        totals: {}
      };

      Array.from(cartListEl.querySelectorAll('.cart-item')).forEach(it=>{
        const id = it.getAttribute('data-id');
        const price = parseIntSafe(it.getAttribute('data-price'));
        const qty = parseIntSafe(it.querySelector('[data-qty]').textContent);
        const title = it.querySelector('.cart-item-title')?.textContent || '';
        order.items.push({ id, title, price, qty, line_total: price * qty });
      });

      const subtotal = parseIntSafe(subtotalEl.getAttribute('data-value') || subtotalEl.textContent);
      const deliveryPrice = parseIntSafe(deliveryPriceEl.getAttribute('data-value') || deliveryPriceEl.textContent);
      order.totals = { subtotal, delivery: deliveryPrice, total: subtotal + deliveryPrice };

      const orders = JSON.parse(localStorage.getItem('padobi_orders') || '[]');
      orders.push(order);
      localStorage.setItem('padobi_orders', JSON.stringify(orders));

      Array.from(cartListEl.querySelectorAll('.cart-item')).forEach(it=>it.remove());
      recalc();

      document.getElementById('orderId').textContent = order.id;
      const summaryText = [
        'К оплате: ' + formatMoney(order.totals.total),
        'Способ доставки: ' + order.delivery.type,
        'Получатель: ' + order.customer.name + ', ' + order.customer.phone
      ].join(' • ');
      document.getElementById('orderSummaryText').textContent = summaryText;

      goToStep(3);
      console.log('Новый заказ (локально сохранён):', order);
      alert('Заказ оформлен. Номер: ' + order.id + '. Информация сохранена локально (localStorage).');
    });

    // initial setup
    (function init(){
      Array.from(cartListEl.querySelectorAll('.cart-item')).forEach(it=>{
        const price = parseIntSafe(it.getAttribute('data-price'));
        const qty = parseIntSafe(it.querySelector('[data-qty]').textContent);
        const line = it.querySelector('[data-line-price]');
        if(line) line.textContent = formatMoney(price * qty);
      });
      deliveryPriceEl.textContent = '0 ₴';
      deliveryPriceEl.setAttribute('data-value', 0);
      recalc();
    })();

    // small UX tweaks
    document.getElementById('dontCallLabel').addEventListener('click', function(e){
      if(e.target.tagName === 'INPUT') return;
      const cb = document.getElementById('dontCallCheck');
      cb.checked = !cb.checked;
    });

    document.getElementById('headerProfileBtn').addEventListener('click', ()=> {
      window.location.href = 'profile.html';
    });

    steps.forEach((s,i)=> s.btn.disabled = !(i === 0));
  </script>
</body>
</html>